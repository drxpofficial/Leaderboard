# üéÆ Leaderboard Application

A modern, feature-rich leaderboard system for CS2 servers with Steam authentication, admin panel, theme customization, and automated wipe scheduling.

## üöÄ Features

- **Steam Authentication** - Secure login via Steam OpenID
- **Real-time Leaderboards** - Live player statistics and rankings
- **Admin Panel** - Comprehensive management interface
- **Theme System** - Customizable color schemes and styling
- **Wipe Scheduling** - Automated server wipe management
- **Multi-Server Support** - Handle multiple game servers
- **Responsive Design** - Mobile-friendly interface
- **Permission System** - Granular admin access control

## üìã Prerequisites

- **Node.js** 18+ installed
- **MySQL Database** (recommended: [Synth Hosting](https://synthhosting.com/))
- **Steam API Key** from [Steam Dev Portal](https://steamcommunity.com/dev/apikey)
- **CS2 Server** with the compatible plugin installed

## ‚ö° Quick Start

1.

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Set up environment variables** (see [Environment Configuration](#-environment-configuration))

4. **Set up database** (see [Database Setup Guide](README_DATABASE.md))

5. **Configure the application** (see [Configuration](#-configuration))

6. **Start development server**
   ```bash
   npm run dev
   ```

## üîê Environment Configuration

Create a `.env` file in your project root with the following variables:

### Database Configuration

```env
# Database Connection (from Synth Hosting)
DATABASE_URL="mysql://username:password@host:port/database"
```

**How to get this:**
- Follow the [Database Setup Guide](README_DATABASE.md)
- Remove the `jdbc:` prefix from Synth Hosting's JDBC connection string

### API Keys

```env
# API Keys for secure communication between your CS2 plugin and the application
API_KEY="your_secure_api_key_here"
NEXT_PUBLIC_API_KEY="your_secure_api_key_here"
```

**Generate secure API keys:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**Important Notes:**
- Use the same value for both `API_KEY` and `NEXT_PUBLIC_API_KEY`
- This key is used by your CS2 plugin to authenticate with your leaderboard API
- Keep this key secure and don't share it publicly

### Steam API Configuration

```env
# Steam API Key for fetching player avatars and Steam data
STEAM_API_KEY="your_steam_api_key_here"
```

**How to get Steam API Key:**
1. Visit [Steam Web API Key](https://steamcommunity.com/dev/apikey)
2. Login with your Steam account
3. Enter your domain name (e.g., `localhost:3000` for development)
4. Copy the generated API key

### NextAuth Configuration

```env
# NextAuth Secret for session encryption
NEXTAUTH_SECRET="your_nextauth_secret_here"

# NextAuth URL (your application's URL)
NEXTAUTH_URL="http://localhost:3000"
```

**Generate NextAuth Secret:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**NextAuth URL Values:**
- **Development**: `http://localhost:3000`
- **Production**: `https://yourdomain.com`

### Complete Example `.env.local`

```env
# Database
DATABASE_URL="mysql://user123:pass456@db.synthhosting.com:3306/leaderboard_db"

# API Keys (use same value for both)
API_KEY="key1"
NEXT_PUBLIC_API_KEY="key2"

# Steam API
STEAM_API_KEY="AB12CD34EF56GH78IJ90KL12MN34OP56QR78ST90"

# NextAuth
NEXTAUTH_SECRET="key3"
NEXTAUTH_URL="http://localhost:3000"
```

## ‚öôÔ∏è Configuration

### Application Configuration (`min.config.json`)

The `min.config.json` file controls your application's branding and navigation:

```json
{
  "serverName": "Your Server Name",
  "navigation": [
    {
      "name": "Home",
      "link": "/"
    },
    {
      "name": "Servers",
      "link": "/servers"
    },
    {
      "name": "Store",
      "link": "https://your-store.com"
    },
    {
      "name": "Leaderboards",
      "link": "/leaderboards"
    },
    {
      "name": "Discord",
      "link": "https://discord.gg/your-invite"
    }
  ]
}
```

**Configuration Options:**

- **`serverName`** - Displayed in the header and page titles
- **`navigation`** - Array of navigation menu items
  - `name` - Display text for the menu item
  - `link` - URL to navigate to (can be internal routes or external links)

**Navigation Link Examples:**
- Internal routes: `/`, `/admin`, `/stats`
- External links: `https://discord.gg/invite`, `https://store.com`
- Anchors: `#section-name`

## üîå CS2 Plugin Integration

Your CS2 server needs a compatible plugin to send player statistics to your leaderboard.

### Plugin Configuration

The plugin should be configured to send HTTP requests to your leaderboard API:

**API Endpoint:** `https://your-domain.com/api/stats`
**Method:** `POST`
**Headers:** 
```
Content-Type: application/json
Authorization: Bearer YOUR_API_KEY
```

**Payload Format:**
```json
{
  "server_id": "your_server_id",
  "steam_id": "76561198000000000",
  "display_name": "Player Name",
  "event_type": "kill" | "death" | "connect" | "disconnect",
  "headshot": true | false,
  "session_time": 3600,
  "timestamp": "2024-01-01T12:00:00Z"
}
```

### Supported Events

- **`kill`** - Player eliminated another player
- **`death`** - Player was eliminated
- **`connect`** - Player joined the server
- **`disconnect`** - Player left the server (should include session_time)

### Server Management

1. **Add your servers** in the admin panel (`/admin/servers`)
2. **Use the same `server_id`** in both the plugin and admin panel
3. **Configure wipe schedules** if desired (`/admin/wipes`)

## üóÑÔ∏è Database Setup

For detailed database setup instructions, see [Database Setup Guide](README_DATABASE.md).

**Quick Commands:**
```bash
# Generate Prisma client
npx prisma generate

# Push schema to database
npx prisma db push

# Seed default data
npm run seed

# Open database browser
npx prisma studio
```

## üé® Theme System

Your application includes a powerful theme system accessible at `/admin/themes`.

### Features
- **Multiple Themes** - Create and manage different color schemes
- **Live Preview** - See changes in real-time
- **17+ Customizable Properties** - Colors, gradients, borders, etc.
- **Mobile Responsive** - Themes work on all devices

### Default Themes
After running `npm run seed`, you'll have:
- **Default Dark** - Main theme with purple accents
- **Gaming Red** - Red accent gaming theme
- **Cyber Blue** - Futuristic blue neon theme
- **Forest Green** - Nature-inspired green theme

## üë• Admin System

### Admin Access Levels

Your application supports granular permissions:

- **`owner_access`** - Full access to all features
- **`manage_admins`** - Add/remove admin users
- **`manage_permissions`** - Assign permissions
- **`view_admin_panel`** - Access admin interface
- **`edit_player_stats`** - Modify player statistics
- **`delete_player_stats`** - Delete player records
- **`server_management`** - Manage servers and wipes
- **`manage_themes`** - Customize themes

### Admin Panel Features

- **`/admin`** - Dashboard with statistics
- **`/admin/players`** - Player management
- **`/admin/admins`** - Admin user management
- **`/admin/servers`** - Server configuration
- **`/admin/wipes`** - Wipe scheduling
- **`/admin/themes`** - Theme customization

## üîÑ Automated Wipe System

### How It Works

1. **Automatic Checks** - System checks for due wipes every 5 minutes when users visit
2. **Scheduled Wipes** - Set up recurring wipes by day/time
3. **Manual Wipes** - Execute immediate wipes from admin panel
4. **Data Safety** - Wipes only delete player statistics, not admin data

### Wipe Configuration

```bash
# Manual wipe check
curl -X POST https://your-domain.com/api/wipes/cron \
  -H "Authorization: Bearer YOUR_API_KEY"

# Execute immediate wipe
curl -X POST https://your-domain.com/api/wipes/execute \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{"serverId": "your_server_id"}'
```

## üöÄ Deployment

### Production Environment Variables

```env
# Update for production
NEXTAUTH_URL="https://yourdomain.com"

# Use production database
DATABASE_URL="mysql://prod_user:prod_pass@prod_host:3306/prod_db"

# Keep API keys secure
API_KEY="your_production_api_key"
NEXT_PUBLIC_API_KEY="your_production_api_key"
```

### Build Commands

```bash
# Build for production
npm run build

# Start production server
npm start
```

### Recommended Hosting

- **Application**: Vercel, Netlify, Railway, Heroku
- **Database**: [Synth Hosting](https://synthhosting.com/), PlanetScale, AWS RDS

## üõ†Ô∏è Development Commands

```bash
# Development server with hot reload
npm run dev

# Build application
npm run build

# Start production server
npm start

# Database commands
npm run db:generate    # Generate Prisma client
npm run db:push        # Push schema changes
npm run db:seed        # Seed default data

# Development with tunnel (for testing with CS2 plugin)
npm run dev:tunnel     # Runs dev server + ngrok tunnel
```

## üìä API Endpoints

### Public Endpoints
- `GET /api/stats` - Get leaderboard data
- `GET /api/servers/active` - Get active servers

### Protected Endpoints (require API key)
- `POST /api/stats` - Submit player statistics
- `GET /api/admins` - Get admin users
- `POST /api/wipes/execute` - Execute server wipe
- `GET /api/themes` - Get theme settings

### Authentication
Include your API key in requests:
```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
     https://your-domain.com/api/stats
```

## üîß Troubleshooting

### Common Issues

**Database Connection Errors:**
- Verify `DATABASE_URL` format
- Ensure database server is running
- Check firewall/network settings

**Steam Authentication Issues:**
- Verify `STEAM_API_KEY` is valid
- Check `NEXTAUTH_URL` matches your domain
- Ensure `NEXTAUTH_SECRET` is set

**Plugin Not Sending Data:**
- Verify `API_KEY` matches in plugin config
- Check server logs for HTTP errors
- Ensure `server_id` exists in admin panel

**Permission Denied:**
- Verify admin user exists in database
- Check admin has correct permissions
- Ensure session is valid

### Debug Mode

Enable debug logging by adding to `.env.local`:
```env
DEBUG=1
NODE_ENV=development
```

### Getting Help

1. **Check application logs** for detailed error messages
2. **Use Prisma Studio** to inspect database directly
3. **Verify environment variables** are correctly set
4. **Test API endpoints** with curl or Postman

## üìÅ Project Structure

```
leaderboard/
‚îú‚îÄ‚îÄ src/app/                 # Next.js app directory
‚îÇ   ‚îú‚îÄ‚îÄ admin/              # Admin panel pages
‚îÇ   ‚îú‚îÄ‚îÄ api/                # API routes
‚îÇ   ‚îú‚îÄ‚îÄ auth/               # Authentication pages
‚îÇ   ‚îî‚îÄ‚îÄ components/         # React components
‚îú‚îÄ‚îÄ lib/                    # Utility libraries
‚îú‚îÄ‚îÄ prisma/                 # Database schema and migrations
‚îú‚îÄ‚îÄ public/                 # Static assets
‚îú‚îÄ‚îÄ min.config.json         # Application configuration
‚îî‚îÄ‚îÄ README_DATABASE.md      # Database setup guide
```

## üìÑ License

This project is licensed under the MIT License.

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

---

**Need Help?** Check the [Database Setup Guide](README_DATABASE.md) or open an issue for support. 
